// src/main.c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <termios.h>

#include "pet_manager.h"
#include "skill_manager.h"
#include "inventory_manager.h"
#include "quest_manager.h"
#include "map_manager.h"
#include "monster_manager.h"
#include "battle_manager.h"
#include "shop_manager.h"
#include "final_boss.h"
#include "save_load.h"
#include "console_ui.h"

// 전역 플레이어 좌표 (토큰 단위)
int playerX, playerY;

// 단일 문자 비블로킹 입력
static int getch(void) {
    struct termios oldt, newt;
    int ch;
    tcgetattr(STDIN_FILENO, &oldt);
    newt = oldt;
    newt.c_lflag &= ~(ICANON | ECHO);
    tcsetattr(STDIN_FILENO, TCSANOW, &newt);
    ch = getchar();
    tcsetattr(STDIN_FILENO, TCSANOW, &oldt);
    return ch;
}

// ─── 1) 인트로 화면 ─────────────────────────────────────────────────────
void draw_intro_screen(void) {
    const int W = WIDTH, H = HEIGHT;
    const char *line1 = "─── 대혼란의 서막 ───";
    const char *line2 = "어둠이 스며든 대륙을 구원할 자여, 일어나라!";
    const char *prompt_1 = "계속하려면 [ENTER]를 누르세요";
    system("clear");
    // 상단 경계
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    // 내용
    printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡠⡒⡒⡑⡒⠢⣄⡔⡒⡒⢒⠒⣦⢒⢒⢒⠒⢔⠢⣂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
    printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢐⠔⡶⣬⠨⡘⡎⢔⢨⣦⣕⡷⣔⡴⡐⡡⣕⡬⡯⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
    printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢐⠌⢝⠡⢊⣜⡇⢕⠨⡊⢎⡯⠉⡗⢔⢘⡾⡙⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
    printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠐⢅⢧⡾⡵⡟⡕⢅⠽⢝⢯⢗⠀⣏⠢⡱⣫⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
    printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣩⡨⣯⠍⠈⠀⣏⣆⣕⣕⣔⢽⢕⣕⣕⣜⡗⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
    printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⡀⠀⢀⣀⣀⣕⢟⡗⣅⡠⣀⢔⢝⠚⡺⡺⣫⢅⢜⡺⣺⡡⣁⢀⡀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
    printf("│   ⠀⠀⡰⠒⡒⢆⡀⢰⢑⠩⠨⡑⠲⢼⡡⡑⢵⡠⡇⠢⣸⠆⢅⣂⣢⡸⡇⡢⠙⢦⡳⠨⢸⣂⢅⢂⠢⡨⢸⡣⢑⣹⢔⢏⢉⢷⢍⢑⢑⢑⠢⡄⡤⠢⠤⢄⢄⡀⠀   │\n");
    printf("│   ⠀⢀⠇⢅⡊⠜⣎⢸⢠⢑⢷⢧⡑⠅⣗⠔⡑⣷⠡⢱⢽⢕⢐⠕⡓⣟⡇⡢⢑⢑⢏⢌⢪⡷⣻⠠⡱⣻⢽⠪⡐⣾⢱⠱⡐⣽⢐⠔⣗⡦⡡⡹⡎⢌⢪⣐⣔⣗⠀   │\n");
    printf("│   ⠀⣸⠨⢢⢧⠡⡹⣎⡇⡢⣻⣡⠣⡑⣽⡪⡰⠱⡑⢕⡿⡕⡐⡵⣖⢷⢇⢊⢮⢆⠢⡢⢹⡕⣪⢊⢜⡧⢱⠕⢌⢾⡸⡑⢌⡾⡐⢅⠫⡨⡢⣯⠪⡐⢝⢱⣳⠣⠀   │\n");
    printf("│   ⠀⡎⠜⣌⢦⡱⡨⢺⡕⢔⠱⡨⢪⢼⡽⢱⣊⢪⠨⣯⢫⡣⡪⡘⡔⣱⡣⡱⣸⢿⡌⣜⣸⡅⡗⡔⣱⡏⠈⣧⡑⡅⡣⡑⣵⡫⢢⢱⡇⡢⢻⢽⠨⡸⡺⣺⢮⠀⠀   │\n");
    printf("│   ⠠⣇⣇⣯⠟⠽⡬⣮⣟⣞⡾⣞⢟⠏⠊⠀⠛⠾⢽⠫⠀⠹⠝⠟⠽⠳⠛⠯⠻⠁⠙⠳⠳⠁⠙⠽⠳⠃⠀⠨⠳⡳⣗⢯⠟⢵⣳⡽⡽⣪⣞⣧⣣⡪⣌⢆⡿⡀⠀   │\n");
    printf("│   ⠀⠘⠱⠙⠀⠀⠉⠁⠁⠀⠈⠀⠀⠀⠀⠀⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠁⠀⠈⠈⠀⠃⠋⠫⠛⠝⠀⠀   │\n");
    printf("│                                                                 │\n");
    printf("│                      \033[1;36m%s\033[0m                      │\n", line1);
    printf("│                                                                 │\n");
    printf("│           \033[1;37m%s\033[0m           │\n", line2);
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⣗⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⡳⡱⡹⢦⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡤⣆⡀⠀⢀⣰⢪⢪⢪⢪⢪⢧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⢏⢎⣷⢁⢴⢹⢰⢱⠱⡱⡱⡱⣹⡆⢠⢦⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡜⡎⡎⡎⡾⡝⡜⡜⢜⠰⡑⡕⡕⡕⣗⠇⣸⢕⢿⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡴⡣⡣⡣⡣⡣⡣⠣⡪⡘⢌⠢⡃⡇⡇⡝⣵⡘⠽⡏⠁⠀⠀⠀⠀⠀⠀⠀⠀⡰⡏⡗⣦⠀⠀⠀⠀⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⢠⢠⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢨⢇⢣⢱⠨⡪⢪⠪⡑⢔⠨⢂⠱⡨⠢⡣⡣⡣⣧⢡⡀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡏⡎⢎⢪⢻⣄⠀⠀⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⢠⠪⠑⡀⢐⠠⢈⠹⣢⠀⠀⠀⠀⠀⠀⠀⠀⡸⡜⡸⢐⢑⢌⠢⠣⡡⠡⢊⠔⠡⡨⢊⢢⠣⡳⡫⡎⢯⢆⠀⠀⠀⠀⠀⠀⣠⢏⡊⡠⡱⡑⡕⢜⢳⡄⠀⠀⠀⠀│\n");
    printf("│⠀⠀⢀⡴⠒⠓⢝⠀⠅⢐⠀⡂⢐⢀⠪⡗⠦⡤⡀⠀⠀⠀⠀⢸⠜⡌⢌⢂⠢⠡⡑⠌⢌⠢⠨⢊⠄⠕⢌⢎⢪⠪⡸⡨⣫⡂⠀⠀⠀⠀⡴⡣⠃⢊⢎⢜⢌⢎⢪⠪⡚⣥⡀⠀⠀│\n");
    printf("│⠀⠀⡗⡁⠌⡐⠠⢈⢐⠠⠂⢂⠂⡐⢁⠐⡐⢈⠹⣢⠀⠀⠀⡮⡑⢌⢂⠅⡪⢈⠢⠡⠡⢊⠌⡂⡊⢌⠢⡡⢑⢘⢌⢆⡻⡆⠀⠀⠀⣞⢕⠐⢀⠜⡔⡱⡘⡌⡆⢇⢇⠕⣗⠄⠀│\n");
    printf("│⠀⠈⡧⡂⠂⠄⠅⢂⠐⠠⢁⢂⠐⡐⠠⢁⢐⠐⡨⣳⠅⠀⢨⠣⡨⢂⢢⡡⢂⢑⠌⠪⠨⡂⣪⡐⢌⢂⠅⡢⢑⠌⡆⢕⢽⡣⠀⠀⢸⢱⢨⠢⡪⢪⠸⡨⢪⢨⢊⢎⢢⢃⢇⣯⠀│\n");
    printf("│⢠⡚⡉⠌⠨⠠⣡⡂⠌⠨⠠⢐⣐⠠⢁⢂⠰⢨⠪⣟⡄⠀⡽⠨⡐⡡⣺⣽⢐⠡⡨⢊⠌⡸⡽⡇⢕⠠⡑⡐⡡⢱⢘⢼⡻⠀⠀⠀⡽⡸⡐⢕⢅⢷⢧⢃⠇⡕⢅⣿⡕⢥⠱⣹⢅│\n");
    printf("│⣸⢀⢐⠨⠠⠡⡻⡂⠡⠡⠈⢜⠽⠈⠄⢂⠨⠀⡕⢔⢽⠄⢯⢊⠔⡐⡑⠣⣑⢌⢔⣐⣅⡪⠙⠅⢕⠨⡐⢌⢌⢆⣗⡿⠑⠀⠀⠀⢹⡢⡃⢇⢪⢚⢣⢣⡵⣱⡅⡇⡫⢢⢣⢿⡁│\n");
    printf("│⠘⣦⡐⢄⠅⢂⢐⢀⠓⠜⢊⢐⠨⠈⠌⡠⡨⠢⡪⠢⣝⡇⠙⡦⡑⠌⢌⠌⢜⢯⢯⢳⢝⢎⢘⠌⡢⢑⠌⡢⣱⣞⠗⠁⠀⠀⢀⡠⣔⢷⢕⡱⢡⠣⡑⡕⠯⢞⢕⠱⡘⣜⣾⣫⡀│\n");
    printf("│⠀⠈⡚⣗⢌⠄⡂⡐⠨⠈⠄⡂⢔⠡⡡⢪⢘⢬⣪⣾⠻⠈⢀⣘⡳⣥⡑⢌⠢⡙⢕⠳⠩⡂⢕⠨⡐⣅⡮⡞⡿⡬⣄⡀⠀⠀⣗⢕⠜⣔⣝⡺⡪⡪⡸⡨⡪⡪⣢⢗⣯⢿⢺⠰⣹│\n");
    printf("│⠀⠰⡍⡪⡳⢜⣔⡕⡅⢥⢑⢌⢆⢇⢕⢅⢣⢱⡹⡌⠀⡼⡣⡣⡫⣳⡟⠷⣵⡪⡦⡱⡱⡸⡰⡱⡹⡸⡸⡸⡸⡸⡨⡫⢮⡠⠘⠳⠟⠗⢳⢏⠎⡎⡇⣏⢮⣚⢾⣕⡧⣫⣺⢼⣳│\n");
    printf("│⠀⠈⠕⡾⣼⡺⣵⢱⢱⢱⠱⡡⡣⡊⡆⡫⣞⡶⡻⠡⠀⢯⡪⣪⡺⡕⡟⡮⡣⡇⡇⢇⢇⢇⢇⢇⢣⢣⢷⡳⡳⣮⢪⢪⢱⣳⠄⠀⣖⢶⢽⡸⡘⡔⢕⢜⡜⣼⡏⡃⠋⠫⠚⠙⠈│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠘⡮⡢⡱⡑⢕⢌⢆⢣⢱⠫⡮⡀⠀⠀⠈⢟⢦⣳⡹⣜⢮⣺⡕⡕⡕⡱⡡⡣⡪⡸⡨⡪⡫⡆⠀⢯⣪⣪⣺⡞⠅⠸⣕⢗⢽⢮⡪⡸⡨⢳⢽⡳⠁⠀⠀⠀⠀⠀│⠀\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⡏⠜⡰⣹⡗⡗⠷⣕⣥⣳⡽⡂⠀⠀⠀⠀⠁⠓⠫⠫⠋⠋⣇⢇⢕⠜⡔⢕⢜⢌⠦⡹⣝⠄⡀⠃⠛⠊⠈⠀⠈⢗⡯⡷⢷⢻⢮⡪⡊⡎⡗⡗⣦⢀⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠘⢳⢳⠻⠐⠀⠀⠈⠘⠈⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢳⢕⠜⣜⢼⠸⡰⡑⡕⣕⢽⢝⢽⢵⡀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠻⣌⢎⢮⣺⡽⠅⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⡺⡱⡑⡕⢕⢱⢱⡺⡭⡳⡝⣎⡯⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⠺⡗⠏⠃⠁⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⠲⠦⡞⡜⢜⢸⢸⣸⣞⡯⡾⣵⢯⢯⣺⣞⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
    printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠷⣝⢕⡕⡕⡕⣕⣷⢛⠐⠈⠈⠈⠀⠁⠁⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
    printf("│                                                                 │\n");
    // printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠺⡵⣕⢕⢼⣺⠕⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
    printf("│                  \033[1;33m%s\033[0m                  │\n", prompt_1);
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    // 엔터를 기다림
    while (getch() != '\n');
}

// ─── 2) 타이틀 메뉴 ─────────────────────────────────────────────────────
int draw_title_menu(void) {
    const int W = WIDTH, H = HEIGHT;
    const char *title  = "펫 어드벤처: 대혼란 탐험기";
    const char *option = "1) 새 게임   2) 불러오기   3) 종료";
    const char *prompt_2="원하는 옵션을 선택 후 [ENTER]";
    int c;
    do {
        system("clear");
        printf("┌"); 
        printf("─────────────────────────────────────────────────────────────────");
        printf("┐\n");
        // 내용
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡠⡒⡒⡑⡒⠢⣄⡔⡒⡒⢒⠒⣦⢒⢒⢒⠒⢔⠢⣂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢐⠔⡶⣬⠨⡘⡎⢔⢨⣦⣕⡷⣔⡴⡐⡡⣕⡬⡯⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢐⠌⢝⠡⢊⣜⡇⢕⠨⡊⢎⡯⠉⡗⢔⢘⡾⡙⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠐⢅⢧⡾⡵⡟⡕⢅⠽⢝⢯⢗⠀⣏⠢⡱⣫⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣩⡨⣯⠍⠈⠀⣏⣆⣕⣕⣔⢽⢕⣕⣕⣜⡗⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⡀⠀⢀⣀⣀⣕⢟⡗⣅⡠⣀⢔⢝⠚⡺⡺⣫⢅⢜⡺⣺⡡⣁⢀⡀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⡰⠒⡒⢆⡀⢰⢑⠩⠨⡑⠲⢼⡡⡑⢵⡠⡇⠢⣸⠆⢅⣂⣢⡸⡇⡢⠙⢦⡳⠨⢸⣂⢅⢂⠢⡨⢸⡣⢑⣹⢔⢏⢉⢷⢍⢑⢑⢑⠢⡄⡤⠢⠤⢄⢄⡀⠀   │\n");
        printf("│   ⠀⢀⠇⢅⡊⠜⣎⢸⢠⢑⢷⢧⡑⠅⣗⠔⡑⣷⠡⢱⢽⢕⢐⠕⡓⣟⡇⡢⢑⢑⢏⢌⢪⡷⣻⠠⡱⣻⢽⠪⡐⣾⢱⠱⡐⣽⢐⠔⣗⡦⡡⡹⡎⢌⢪⣐⣔⣗⠀   │\n");
        printf("│   ⠀⣸⠨⢢⢧⠡⡹⣎⡇⡢⣻⣡⠣⡑⣽⡪⡰⠱⡑⢕⡿⡕⡐⡵⣖⢷⢇⢊⢮⢆⠢⡢⢹⡕⣪⢊⢜⡧⢱⠕⢌⢾⡸⡑⢌⡾⡐⢅⠫⡨⡢⣯⠪⡐⢝⢱⣳⠣⠀   │\n");
        printf("│   ⠀⡎⠜⣌⢦⡱⡨⢺⡕⢔⠱⡨⢪⢼⡽⢱⣊⢪⠨⣯⢫⡣⡪⡘⡔⣱⡣⡱⣸⢿⡌⣜⣸⡅⡗⡔⣱⡏⠈⣧⡑⡅⡣⡑⣵⡫⢢⢱⡇⡢⢻⢽⠨⡸⡺⣺⢮⠀⠀   │\n");
        printf("│   ⠠⣇⣇⣯⠟⠽⡬⣮⣟⣞⡾⣞⢟⠏⠊⠀⠛⠾⢽⠫⠀⠹⠝⠟⠽⠳⠛⠯⠻⠁⠙⠳⠳⠁⠙⠽⠳⠃⠀⠨⠳⡳⣗⢯⠟⢵⣳⡽⡽⣪⣞⣧⣣⡪⣌⢆⡿⡀⠀   │\n");
        printf("│   ⠀⠘⠱⠙⠀⠀⠉⠁⠁⠀⠈⠀⠀⠀⠀⠀⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠁⠀⠈⠈⠀⠃⠋⠫⠛⠝⠀⠀   │\n");
        printf("│                    \033[1;36m%s\033[0m                   │\n", title);
        printf("│                                                                 │\n");
        printf("│              \033[1;33m%s\033[0m                 │\n", option);
        printf("│                                                                 │\n");
        printf("│                 \033[1;35m%s\033[0m                   │\n", prompt_2);
        printf("│                                                                 │\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⣗⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⡳⡱⡹⢦⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡤⣆⡀⠀⢀⣰⢪⢪⢪⢪⢪⢧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⢏⢎⣷⢁⢴⢹⢰⢱⠱⡱⡱⡱⣹⡆⢠⢦⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡜⡎⡎⡎⡾⡝⡜⡜⢜⠰⡑⡕⡕⡕⣗⠇⣸⢕⢿⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡴⡣⡣⡣⡣⡣⡣⠣⡪⡘⢌⠢⡃⡇⡇⡝⣵⡘⠽⡏⠁⠀⠀⠀⠀⠀⠀⠀⠀⡰⡏⡗⣦⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⢠⢠⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢨⢇⢣⢱⠨⡪⢪⠪⡑⢔⠨⢂⠱⡨⠢⡣⡣⡣⣧⢡⡀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡏⡎⢎⢪⢻⣄⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⢠⠪⠑⡀⢐⠠⢈⠹⣢⠀⠀⠀⠀⠀⠀⠀⠀⡸⡜⡸⢐⢑⢌⠢⠣⡡⠡⢊⠔⠡⡨⢊⢢⠣⡳⡫⡎⢯⢆⠀⠀⠀⠀⠀⠀⣠⢏⡊⡠⡱⡑⡕⢜⢳⡄⠀⠀⠀⠀│\n");
        printf("│⠀⠀⢀⡴⠒⠓⢝⠀⠅⢐⠀⡂⢐⢀⠪⡗⠦⡤⡀⠀⠀⠀⠀⢸⠜⡌⢌⢂⠢⠡⡑⠌⢌⠢⠨⢊⠄⠕⢌⢎⢪⠪⡸⡨⣫⡂⠀⠀⠀⠀⡴⡣⠃⢊⢎⢜⢌⢎⢪⠪⡚⣥⡀⠀⠀│\n");
        printf("│⠀⠀⡗⡁⠌⡐⠠⢈⢐⠠⠂⢂⠂⡐⢁⠐⡐⢈⠹⣢⠀⠀⠀⡮⡑⢌⢂⠅⡪⢈⠢⠡⠡⢊⠌⡂⡊⢌⠢⡡⢑⢘⢌⢆⡻⡆⠀⠀⠀⣞⢕⠐⢀⠜⡔⡱⡘⡌⡆⢇⢇⠕⣗⠄⠀│\n");
        printf("│⠀⠈⡧⡂⠂⠄⠅⢂⠐⠠⢁⢂⠐⡐⠠⢁⢐⠐⡨⣳⠅⠀⢨⠣⡨⢂⢢⡡⢂⢑⠌⠪⠨⡂⣪⡐⢌⢂⠅⡢⢑⠌⡆⢕⢽⡣⠀⠀⢸⢱⢨⠢⡪⢪⠸⡨⢪⢨⢊⢎⢢⢃⢇⣯⠀│\n");
        printf("│⢠⡚⡉⠌⠨⠠⣡⡂⠌⠨⠠⢐⣐⠠⢁⢂⠰⢨⠪⣟⡄⠀⡽⠨⡐⡡⣺⣽⢐⠡⡨⢊⠌⡸⡽⡇⢕⠠⡑⡐⡡⢱⢘⢼⡻⠀⠀⠀⡽⡸⡐⢕⢅⢷⢧⢃⠇⡕⢅⣿⡕⢥⠱⣹⢅│\n");
        printf("│⣸⢀⢐⠨⠠⠡⡻⡂⠡⠡⠈⢜⠽⠈⠄⢂⠨⠀⡕⢔⢽⠄⢯⢊⠔⡐⡑⠣⣑⢌⢔⣐⣅⡪⠙⠅⢕⠨⡐⢌⢌⢆⣗⡿⠑⠀⠀⠀⢹⡢⡃⢇⢪⢚⢣⢣⡵⣱⡅⡇⡫⢢⢣⢿⡁│\n");
        printf("│⠘⣦⡐⢄⠅⢂⢐⢀⠓⠜⢊⢐⠨⠈⠌⡠⡨⠢⡪⠢⣝⡇⠙⡦⡑⠌⢌⠌⢜⢯⢯⢳⢝⢎⢘⠌⡢⢑⠌⡢⣱⣞⠗⠁⠀⠀⢀⡠⣔⢷⢕⡱⢡⠣⡑⡕⠯⢞⢕⠱⡘⣜⣾⣫⡀│\n");
        printf("│⠀⠈⡚⣗⢌⠄⡂⡐⠨⠈⠄⡂⢔⠡⡡⢪⢘⢬⣪⣾⠻⠈⢀⣘⡳⣥⡑⢌⠢⡙⢕⠳⠩⡂⢕⠨⡐⣅⡮⡞⡿⡬⣄⡀⠀⠀⣗⢕⠜⣔⣝⡺⡪⡪⡸⡨⡪⡪⣢⢗⣯⢿⢺⠰⣹│\n");
        printf("│⠀⠰⡍⡪⡳⢜⣔⡕⡅⢥⢑⢌⢆⢇⢕⢅⢣⢱⡹⡌⠀⡼⡣⡣⡫⣳⡟⠷⣵⡪⡦⡱⡱⡸⡰⡱⡹⡸⡸⡸⡸⡸⡨⡫⢮⡠⠘⠳⠟⠗⢳⢏⠎⡎⡇⣏⢮⣚⢾⣕⡧⣫⣺⢼⣳│\n");
        printf("│⠀⠈⠕⡾⣼⡺⣵⢱⢱⢱⠱⡡⡣⡊⡆⡫⣞⡶⡻⠡⠀⢯⡪⣪⡺⡕⡟⡮⡣⡇⡇⢇⢇⢇⢇⢇⢣⢣⢷⡳⡳⣮⢪⢪⢱⣳⠄⠀⣖⢶⢽⡸⡘⡔⢕⢜⡜⣼⡏⡃⠋⠫⠚⠙⠈│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠘⡮⡢⡱⡑⢕⢌⢆⢣⢱⠫⡮⡀⠀⠀⠈⢟⢦⣳⡹⣜⢮⣺⡕⡕⡕⡱⡡⡣⡪⡸⡨⡪⡫⡆⠀⢯⣪⣪⣺⡞⠅⠸⣕⢗⢽⢮⡪⡸⡨⢳⢽⡳⠁⠀⠀⠀⠀⠀│⠀\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⡏⠜⡰⣹⡗⡗⠷⣕⣥⣳⡽⡂⠀⠀⠀⠀⠁⠓⠫⠫⠋⠋⣇⢇⢕⠜⡔⢕⢜⢌⠦⡹⣝⠄⡀⠃⠛⠊⠈⠀⠈⢗⡯⡷⢷⢻⢮⡪⡊⡎⡗⡗⣦⢀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠘⢳⢳⠻⠐⠀⠀⠈⠘⠈⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢳⢕⠜⣜⢼⠸⡰⡑⡕⣕⢽⢝⢽⢵⡀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠻⣌⢎⢮⣺⡽⠅⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⡺⡱⡑⡕⢕⢱⢱⡺⡭⡳⡝⣎⡯⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⠺⡗⠏⠃⠁⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⠲⠦⡞⡜⢜⢸⢸⣸⣞⡯⡾⣵⢯⢯⣺⣞⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠷⣝⢕⡕⡕⡕⣕⣷⢛⠐⠈⠈⠈⠀⠁⠁⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        // printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠺⡵⣕⢕⢼⣺⠕⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("└"); 
        printf("─────────────────────────────────────────────────────────────────");
        printf("┘\n");
        c = getch();
    } while (c!='1' && c!='2' && c!='3');
    return c - '0';
}

static int conversation_pet_menu(void)
{
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테를 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테를 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 뭐 단순한 옛날 이야기에 불과하겠지만!                    │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테를 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 뭐 단순한 옛날 이야기에 불과하겠지만!                    │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 음? 그건 뭔가? 상자?                                     │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테를 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 뭐 단순한 옛날 이야기에 불과하겠지만!                    │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 음? 그건 뭔가? 상자?                                     │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 보아하니 펫 상자같은대... 그거, 단순한 펫 상자라곤.....  │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(2000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테를 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 뭐 단순한 옛날 이야기에 불과하겠지만!                    │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 음? 그건 뭔가? 상자?                                     │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 보아하니 펫 상자같은대... 그거, 단순한 펫 상자라곤.....  │\n");
    printf("│                                                                 │\n");
    printf("│ (펑하는 효과음과 함께 상자가 열린다.)                           │ \n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(2000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테를 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 뭐 단순한 옛날 이야기에 불과하겠지만!                    │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 음? 그건 뭔가? 상자?                                     │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 보아하니 펫 상자같은대... 그거, 단순한 펫 상자라곤.....  │\n");
    printf("│                                                                 │\n");
    printf("│ (펑하는 효과음과 함께 상자가 열린다.)                           │ \n");
    printf("│                                                                 │\n");
    printf("│ 플레이어 : 어...어, 이게 무슨!?                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테를 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 뭐 단순한 옛날 이야기에 불과하겠지만!                    │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 음? 그건 뭔가? 상자?                                     │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 보아하니 펫 상자같은대... 그거, 단순한 펫 상자라곤.....  │\n");
    printf("│                                                                 │\n");
    printf("│ (펑하는 효과음과 함께 상자가 열린다.)                           │ \n");
    printf("│                                                                 │\n");
    printf("│ 플레이어 : 어...어, 이게 무슨!?                                 │\n");
    printf("│                                                                 │\n");
    printf("│ 구름이 ☁️ : 안녕, 인간~! 만나서 반가워!                          │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테를 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 뭐 단순한 옛날 이야기에 불과하겠지만!                    │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 음? 그건 뭔가? 상자?                                     │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 보아하니 펫 상자같은대... 그거, 단순한 펫 상자라곤.....  │\n");
    printf("│                                                                 │\n");
    printf("│ (펑하는 효과음과 함께 상자가 열린다.)                           │ \n");
    printf("│                                                                 │\n");
    printf("│ 플레이어 : 어...어, 이게 무슨!?                                 │\n");
    printf("│                                                                 │\n");
    printf("│ 구름이 ☁️ : 안녕, 인간~! 만나서 반가워!                          │\n");
    printf("│                                                                 │\n");
    printf("│ 불꽃이 🔥 : 오! 그대가 내 파트너가 될 인간인가!?                │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테르 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 뭐 단순한 옛날 이야기에 불과하겠지만!                    │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 음? 그건 뭔가? 상자?                                     │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 보아하니 펫 상자같은대... 그거, 단순한 펫 상자라곤.....  │\n");
    printf("│                                                                 │\n");
    printf("│ (펑하는 효과음과 함께 상자가 열린다.)                           │ \n");
    printf("│                                                                 │\n");
    printf("│ 플레이어 : 어...어, 이게 무슨!?                                 │\n");
    printf("│                                                                 │\n");
    printf("│ 구름이 ☁️ : 안녕, 인간~! 만나서 반가워!                          │\n");
    printf("│                                                                 │\n");
    printf("│ 불꽃이 🔥 : 오! 그대가 내 파트너가 될 인간인가!?                │\n");
    printf("│                                                                 │\n");
    printf("│ 방울이 💧 : 세상을 깨끗하게 만들 준비됐어, 인간?                │\n");
    printf("│                                                                 │\n");
    printf("│                                                                 │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(1000000);
    system("clear");
    printf("┌"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┐\n");
    printf("│ (사람들의 웃음소리가 크게 들린다.)                              │\n");
    printf("│                                                                 │\n");
    printf("│ (누군가 다가와 말은 건다.)                                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 이봐, 젊은이! 축제는 즐기고 있나?                        │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 그러고보니 오늘 밤, 달빛 아래 에테를 샘이                │\n│ 위험에 빠진다는 아주 오래된 전설이 있었지.                      │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 뭐 단순한 옛날 이야기에 불과하겠지만!                    │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 음? 그건 뭔가? 상자?                                     │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 보아하니 펫 상자같은대... 그거, 단순한 펫 상자라곤.....  │\n");
    printf("│                                                                 │\n");
    printf("│ (펑하는 효과음과 함께 상자가 열린다.)                           │ \n");
    printf("│                                                                 │\n");
    printf("│ 플레이어 : 어...어, 이게 무슨!?                                 │\n");
    printf("│                                                                 │\n");
    printf("│ 구름이 ☁️ : 안녕, 인간~! 만나서 반가워!                          │\n");
    printf("│                                                                 │\n");
    printf("│ 불꽃이 🔥 : 오! 그대가 내 파트너가 될 인간인가!?                │\n");
    printf("│                                                                 │\n");
    printf("│ 방울이 💧 : 세상을 깨끗하게 만들 준비됐어, 인간?                │\n");
    printf("│                                                                 │\n");
    printf("│ 이장 : 펫들의 선택을 받았군. 하나를 선택하고 날 찾아오게.       │\n");
    printf("└"); 
    printf("─────────────────────────────────────────────────────────────────");
    printf("┘\n");
    usleep(2000000);
    printf("[ENTER]");
    getchar();
    system("clear");
}



// ─── 3) 펫 선택 메뉴 (새 게임 전용) ─────────────────────────────────────
int draw_pet_menu(void) {
    const int W = WIDTH, H = HEIGHT;
    const char *menu   = "0) 구름이 ☁️  1) 불꽃이 🔥  2) 방울이 💧 ";
    const char *prompt_3 = "함께할 펫 친구를 고르고 [ENTER]를 입력하세요";
    int c;
    do {
        system("clear");
        printf("┌"); 
        printf("─────────────────────────────────────────────────────────────────");
        printf("┐\n");
        // 내용
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡠⡒⡒⡑⡒⠢⣄⡔⡒⡒⢒⠒⣦⢒⢒⢒⠒⢔⠢⣂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢐⠔⡶⣬⠨⡘⡎⢔⢨⣦⣕⡷⣔⡴⡐⡡⣕⡬⡯⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⢐⠌⢝⠡⢊⣜⡇⢕⠨⡊⢎⡯⠉⡗⢔⢘⡾⡙⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠐⢅⢧⡾⡵⡟⡕⢅⠽⢝⢯⢗⠀⣏⠢⡱⣫⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣩⡨⣯⠍⠈⠀⣏⣆⣕⣕⣔⢽⢕⣕⣕⣜⡗⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⡀⠀⢀⣀⣀⣕⢟⡗⣅⡠⣀⢔⢝⠚⡺⡺⣫⢅⢜⡺⣺⡡⣁⢀⡀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   │\n");
        printf("│   ⠀⠀⡰⠒⡒⢆⡀⢰⢑⠩⠨⡑⠲⢼⡡⡑⢵⡠⡇⠢⣸⠆⢅⣂⣢⡸⡇⡢⠙⢦⡳⠨⢸⣂⢅⢂⠢⡨⢸⡣⢑⣹⢔⢏⢉⢷⢍⢑⢑⢑⠢⡄⡤⠢⠤⢄⢄⡀⠀   │\n");
        printf("│   ⠀⢀⠇⢅⡊⠜⣎⢸⢠⢑⢷⢧⡑⠅⣗⠔⡑⣷⠡⢱⢽⢕⢐⠕⡓⣟⡇⡢⢑⢑⢏⢌⢪⡷⣻⠠⡱⣻⢽⠪⡐⣾⢱⠱⡐⣽⢐⠔⣗⡦⡡⡹⡎⢌⢪⣐⣔⣗⠀   │\n");
        printf("│   ⠀⣸⠨⢢⢧⠡⡹⣎⡇⡢⣻⣡⠣⡑⣽⡪⡰⠱⡑⢕⡿⡕⡐⡵⣖⢷⢇⢊⢮⢆⠢⡢⢹⡕⣪⢊⢜⡧⢱⠕⢌⢾⡸⡑⢌⡾⡐⢅⠫⡨⡢⣯⠪⡐⢝⢱⣳⠣⠀   │\n");
        printf("│   ⠀⡎⠜⣌⢦⡱⡨⢺⡕⢔⠱⡨⢪⢼⡽⢱⣊⢪⠨⣯⢫⡣⡪⡘⡔⣱⡣⡱⣸⢿⡌⣜⣸⡅⡗⡔⣱⡏⠈⣧⡑⡅⡣⡑⣵⡫⢢⢱⡇⡢⢻⢽⠨⡸⡺⣺⢮⠀⠀   │\n");
        printf("│   ⠠⣇⣇⣯⠟⠽⡬⣮⣟⣞⡾⣞⢟⠏⠊⠀⠛⠾⢽⠫⠀⠹⠝⠟⠽⠳⠛⠯⠻⠁⠙⠳⠳⠁⠙⠽⠳⠃⠀⠨⠳⡳⣗⢯⠟⢵⣳⡽⡽⣪⣞⣧⣣⡪⣌⢆⡿⡀⠀   │\n");
        printf("│   ⠀⠘⠱⠙⠀⠀⠉⠁⠁⠀⠈⠀⠀⠀⠀⠀⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠁⠀⠈⠈⠀⠃⠋⠫⠛⠝⠀⠀   │\n");
        printf("│                                                                 │\n");
        printf("│             \033[1;32m%s\033[0m            │\n", menu);
        printf("│                                                                 │\n");
        printf("│           \033[1;35m%s\033[0m          │\n", prompt_3);
        printf("│                                                                 │\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⣗⢦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⡳⡱⡹⢦⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡤⣆⡀⠀⢀⣰⢪⢪⢪⢪⢪⢧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⢏⢎⣷⢁⢴⢹⢰⢱⠱⡱⡱⡱⣹⡆⢠⢦⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡜⡎⡎⡎⡾⡝⡜⡜⢜⠰⡑⡕⡕⡕⣗⠇⣸⢕⢿⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡴⡣⡣⡣⡣⡣⡣⠣⡪⡘⢌⠢⡃⡇⡇⡝⣵⡘⠽⡏⠁⠀⠀⠀⠀⠀⠀⠀⠀⡰⡏⡗⣦⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⢠⢠⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢨⢇⢣⢱⠨⡪⢪⠪⡑⢔⠨⢂⠱⡨⠢⡣⡣⡣⣧⢡⡀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡏⡎⢎⢪⢻⣄⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⢠⠪⠑⡀⢐⠠⢈⠹⣢⠀⠀⠀⠀⠀⠀⠀⠀⡸⡜⡸⢐⢑⢌⠢⠣⡡⠡⢊⠔⠡⡨⢊⢢⠣⡳⡫⡎⢯⢆⠀⠀⠀⠀⠀⠀⣠⢏⡊⡠⡱⡑⡕⢜⢳⡄⠀⠀⠀⠀│\n");
        printf("│⠀⠀⢀⡴⠒⠓⢝⠀⠅⢐⠀⡂⢐⢀⠪⡗⠦⡤⡀⠀⠀⠀⠀⢸⠜⡌⢌⢂⠢⠡⡑⠌⢌⠢⠨⢊⠄⠕⢌⢎⢪⠪⡸⡨⣫⡂⠀⠀⠀⠀⡴⡣⠃⢊⢎⢜⢌⢎⢪⠪⡚⣥⡀⠀⠀│\n");
        printf("│⠀⠀⡗⡁⠌⡐⠠⢈⢐⠠⠂⢂⠂⡐⢁⠐⡐⢈⠹⣢⠀⠀⠀⡮⡑⢌⢂⠅⡪⢈⠢⠡⠡⢊⠌⡂⡊⢌⠢⡡⢑⢘⢌⢆⡻⡆⠀⠀⠀⣞⢕⠐⢀⠜⡔⡱⡘⡌⡆⢇⢇⠕⣗⠄⠀│\n");
        printf("│⠀⠈⡧⡂⠂⠄⠅⢂⠐⠠⢁⢂⠐⡐⠠⢁⢐⠐⡨⣳⠅⠀⢨⠣⡨⢂⢢⡡⢂⢑⠌⠪⠨⡂⣪⡐⢌⢂⠅⡢⢑⠌⡆⢕⢽⡣⠀⠀⢸⢱⢨⠢⡪⢪⠸⡨⢪⢨⢊⢎⢢⢃⢇⣯⠀│\n");
        printf("│⢠⡚⡉⠌⠨⠠⣡⡂⠌⠨⠠⢐⣐⠠⢁⢂⠰⢨⠪⣟⡄⠀⡽⠨⡐⡡⣺⣽⢐⠡⡨⢊⠌⡸⡽⡇⢕⠠⡑⡐⡡⢱⢘⢼⡻⠀⠀⠀⡽⡸⡐⢕⢅⢷⢧⢃⠇⡕⢅⣿⡕⢥⠱⣹⢅│\n");
        printf("│⣸⢀⢐⠨⠠⠡⡻⡂⠡⠡⠈⢜⠽⠈⠄⢂⠨⠀⡕⢔⢽⠄⢯⢊⠔⡐⡑⠣⣑⢌⢔⣐⣅⡪⠙⠅⢕⠨⡐⢌⢌⢆⣗⡿⠑⠀⠀⠀⢹⡢⡃⢇⢪⢚⢣⢣⡵⣱⡅⡇⡫⢢⢣⢿⡁│\n");
        printf("│⠘⣦⡐⢄⠅⢂⢐⢀⠓⠜⢊⢐⠨⠈⠌⡠⡨⠢⡪⠢⣝⡇⠙⡦⡑⠌⢌⠌⢜⢯⢯⢳⢝⢎⢘⠌⡢⢑⠌⡢⣱⣞⠗⠁⠀⠀⢀⡠⣔⢷⢕⡱⢡⠣⡑⡕⠯⢞⢕⠱⡘⣜⣾⣫⡀│\n");
        printf("│⠀⠈⡚⣗⢌⠄⡂⡐⠨⠈⠄⡂⢔⠡⡡⢪⢘⢬⣪⣾⠻⠈⢀⣘⡳⣥⡑⢌⠢⡙⢕⠳⠩⡂⢕⠨⡐⣅⡮⡞⡿⡬⣄⡀⠀⠀⣗⢕⠜⣔⣝⡺⡪⡪⡸⡨⡪⡪⣢⢗⣯⢿⢺⠰⣹│\n");
        printf("│⠀⠰⡍⡪⡳⢜⣔⡕⡅⢥⢑⢌⢆⢇⢕⢅⢣⢱⡹⡌⠀⡼⡣⡣⡫⣳⡟⠷⣵⡪⡦⡱⡱⡸⡰⡱⡹⡸⡸⡸⡸⡸⡨⡫⢮⡠⠘⠳⠟⠗⢳⢏⠎⡎⡇⣏⢮⣚⢾⣕⡧⣫⣺⢼⣳│\n");
        printf("│⠀⠈⠕⡾⣼⡺⣵⢱⢱⢱⠱⡡⡣⡊⡆⡫⣞⡶⡻⠡⠀⢯⡪⣪⡺⡕⡟⡮⡣⡇⡇⢇⢇⢇⢇⢇⢣⢣⢷⡳⡳⣮⢪⢪⢱⣳⠄⠀⣖⢶⢽⡸⡘⡔⢕⢜⡜⣼⡏⡃⠋⠫⠚⠙⠈│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠘⡮⡢⡱⡑⢕⢌⢆⢣⢱⠫⡮⡀⠀⠀⠈⢟⢦⣳⡹⣜⢮⣺⡕⡕⡕⡱⡡⡣⡪⡸⡨⡪⡫⡆⠀⢯⣪⣪⣺⡞⠅⠸⣕⢗⢽⢮⡪⡸⡨⢳⢽⡳⠁⠀⠀⠀⠀⠀│⠀\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⡏⠜⡰⣹⡗⡗⠷⣕⣥⣳⡽⡂⠀⠀⠀⠀⠁⠓⠫⠫⠋⠋⣇⢇⢕⠜⡔⢕⢜⢌⠦⡹⣝⠄⡀⠃⠛⠊⠈⠀⠈⢗⡯⡷⢷⢻⢮⡪⡊⡎⡗⡗⣦⢀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠘⢳⢳⠻⠐⠀⠀⠈⠘⠈⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢳⢕⠜⣜⢼⠸⡰⡑⡕⣕⢽⢝⢽⢵⡀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠻⣌⢎⢮⣺⡽⠅⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⡺⡱⡑⡕⢕⢱⢱⡺⡭⡳⡝⣎⡯⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⠺⡗⠏⠃⠁⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⠲⠦⡞⡜⢜⢸⢸⣸⣞⡯⡾⣵⢯⢯⣺⣞⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠷⣝⢕⡕⡕⡕⣕⣷⢛⠐⠈⠈⠈⠀⠁⠁⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("│                                                                 │\n");
        // printf("│⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠺⡵⣕⢕⢼⣺⠕⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│\n");
        printf("└"); 
        printf("─────────────────────────────────────────────────────────────────");
        printf("┘\n");
        c = getch();
    } while (c!='0' && c!='1' && c!='2');
    return c - '0';
}
int main(void) {
    // 1) 초기화
    init_game();
    init_inventory();
    init_quests();
    init_maps();
    init_monsters();

    // 2) 인트로
    draw_intro_screen();

    // 3) 플레이어 시작 위치 (토큰 중앙)
    playerX = MAP_TOKENS_W/2;
    playerY = HEIGHT/2;

    // 4) 타이틀 메뉴 반복
    while (1) {
        int choice = draw_title_menu();
        if (choice == 3) {
            // 종료
            return 0;
        }
        if (choice == 1) {
            // 새 게임
            if (save_exists()) {
                printf("기존 저장 데이터가 있습니다. 덮어씌우시겠습니까? (Y/N): ");
                int c = getchar();
                while (getchar() != '\n');
                if (c != 'Y' && c != 'y') {
                    continue;  // 다시 제목 메뉴
                }
            }
            // 새 게임 전용 초기화 (저장 데이터 덮어쓰기)
            init_game();
            init_inventory();
            init_quests();
            init_maps();
            init_monsters();

            conversation_pet_menu();
            // 펫 선택
            int pid = draw_pet_menu();
            select_pet(pid);
            // 기존 세이브 삭제
            remove(SAVE_FILE);
            break;  // 메인 게임 루프로
        }
        else if (choice == 2) {
            // 불러오기
            if (!load_game()) {
                printf("불러오기 실패!\n");
                sleep(1);
                continue;
            }
            break;
        }
        else {
            exit(0);
        }
    }



    // 7) 메인 루프
    while (1) {
        
        draw_ui(playerX, playerY);

        // 이동 & 메뉴 입력
        handle_map_input(&playerX, &playerY);
        
        // ── 몬스터 충돌 체크 ──────────────────────────────────
        SpawnedMonster *m = monster_at(playerX, playerY);
        if (m) {
            // id 와 포인터 전달 → battle_manager 에서 보상까지 처리
            start_battle(m->base.id, m);
            // 전투 루프
            while (in_battle()) {
                process_battle_turn();
            }
            // 전투 승리 시 몬스터 제거
            if (battleWon) {
                remove_monster(m);
            }
        }



            // NPC 충돌 (퀘스트 수락)
        NPC *n = npc_at(playerX, playerY);
        if (n) {
            accept_quest(n->questId);
        }

        // 상점 충돌 (쇼핑 메뉴)
        if (shop_at(playerX, playerY)) {
            show_shop_menu();
        }



        // ── 이벤트/포탈 처리 ────────────────────────────────
        process_events(playerX, playerY);

        // ── 퀘스트 완료 보상 지급 & 다음 퀘스트 오픈 ──────────
        check_quest_completion();

        // ── 최종 보스 진입 조건 ──────────────────────────────
        if (check_final_boss_entry() && is_at_altar(playerX, playerY)) {
            enter_final_boss();
            show_ending();
            break;
        }

        usleep(100000);
    }

    // 8) 자동 저장
    save_game();
    return 0;
}
